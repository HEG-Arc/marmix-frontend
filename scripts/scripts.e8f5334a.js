"use strict";angular.module("marmixApp",["ngAnimate","ngCookies","ngRoute","ngSanitize","ngTouch","ui.bootstrap","smart-table","adf","adf.provider","adf.structures.base"]).config(["$routeProvider","$httpProvider",function(a,b){b.defaults.withCredentials=!0,b.interceptors.push("sessionRecoverer"),a.when("/ticker",{templateUrl:"views/ticker.html",controller:"TickerCtrl"}).when("/clock",{templateUrl:"views/clock.html",controller:"ClockCtrl"}).when("/board/:id",{templateUrl:"views/dashboard.html",controller:"DashboardCtrl",controllerAs:"dashboard"}).otherwise({redirectTo:"/board/0"})}]),angular.module("marmixApp").service("marmixData",["$http","$q","$filter","$timeout","$interval",function(a,b,c,d,e){function f(a){return a.date="R"+a.sim_round+"/D"+c("numberFixedLen")(a.sim_day,2),a.symbol=a.stock.symbol,a}var g=this,h="https://m3.marmix.ch/api/v1";this.holdings={},this.market=[],this.orders=[],this.booksoforders={},this.stocksDetails={},this.clock={},this.getStock=function(a){var b=0;if(g.market)for(b=0;b<g.market.length;b++)if(g.market[b].id===Number(a))return g.market[b];return void 0},this.getStockFromSymbol=function(a){for(var b=0;b<g.market.length;b++)if(g.market[b].symbol===a)return g.market[b]},this.getStockPromiseFromSymbol=function(a){function c(b){d(function(){var d=g.getStockFromSymbol(a);d?e.resolve(d):b>1e3?e.reject("timeout"):c(b+100)},b)}var e=b.defer();return c(0),e.promise},this.cancelOrder=function(b){a["delete"](h+"/order/"+b.id+"/").success(function(){g.orders.splice(g.orders.indexOf(b),1)})},this.sendOrder=function(b){a.post(h+"/order/",b).success(function(b){a.get(h+"/orders/"+b.id+"/").success(function(a){g.orders.unshift(a)})})},this.getCurrentUser=function(){var c=b.defer();return g.userId?c.resolve(g.userId):a.get(h+"/current-user/").then(function(a){g.userId=a.data.id,c.resolve(g.userId)},c.reject),c.promise},this.saveDashboards=function(b){return g.getCurrentUser().then(function(c){return a.put(h+"/users/"+c+"/",{dashboards:b})})},this.getDashboards=function(){return g.getCurrentUser().then(function(b){return a.get(h+"/users/"+b+"/")})},this.updateHoldings=function(){a.get(h+"/holdings/").success(function(a){g.holdings=a,g.clock=a.clock})},this.updateHoldings(),this.updateOrders=function(){a.get(h+"/orders/").success(function(a){g.orders=a,g.orders=g.orders.map(f)}),a.get(h+"/dividends/").success(function(a){g.dividends=a})},this.updateOrders(),this.updateMarket=function(){a.get(h+"/market/").success(function(a){g.market=a})},this.updateMarket(),this.updateStock=function(b){isNaN(b)||a.get(h+"/stocks/"+b+"/").success(function(a){g.stocksDetails[b]=a;var c=(new Date).getYear()+1900;g.stocksDetails[b].history.filter(function(a){return 0!==a.sim_day}).forEach(function(a){a.date=new Date(c,a.sim_round+1,a.sim_day,0,0,0,0)})})},this.updateStocksDetails=function(){Object.keys(g.stocksDetails).forEach(g.updateStock)},this.updateStockBook=function(b){isNaN(b)||a.get(h+"/book/"+b+"/").success(function(a){g.booksoforders[b]=a})},this.updateBooksofOrders=function(){Object.keys(g.booksoforders).forEach(g.updateStockBook)},this.updateBooksofOrders(),this.findDashboard=function(a){for(var b=a;!b.hasOwnProperty("dashboard");)b=b.$parent;return b.dashboard},e(this.updateHoldings,5e3),e(this.updateOrders,15e3),e(this.updateMarket,5e3),e(this.updateStocksDetails,15e3),e(this.updateBooksofOrders,5e3)}]),angular.module("marmixApp").factory("sessionRecoverer",["$q","$injector","$window",function(a,b,c){var d={responseError:function(d){if(403===d.status||0===d.status){var e=b.get("$http"),f=a.defer(),g=c.prompt("Username?"),h=c.prompt("Password?");if(g&&h)return e.post("https://m3.marmix.ch/api/v1/auth/login/",{username:g,password:h}).then(f.resolve,f.reject),f.promise.then(function(){return e(d.config)})}return a.reject(d)}};return d}]),angular.module("marmixApp").service("dashboardStore",["marmixData","$q","$timeout",function(a,b,c){function d(){return[f.create(),{title:"Demo A F",titleTemplateUrl:"views/custom-dashboard-title.html",structure:"12/6-6",rows:[{columns:[{styleClass:"col-md-12",widgets:[{type:"holdings",config:{stock:{AA:!0,FF:!0}}}]}]},{columns:[{styleClass:"col-md-6",widgets:[{type:"chart",config:{symbol:"AA"}},{type:"bookoforders",config:{symbol:"AA",threshold:5}},{type:"orderform",config:{activeSelection:!0}}]},{styleClass:"col-md-6",widgets:[{type:"chart",config:{symbol:"FF"}},{type:"bookoforders",config:{symbol:"FF",threshold:5}}]}]}]}]}function e(){var a=localStorage.getItem("dashboard");a?f.dashboards=angular.fromJson(a):(f.dashboards=d(),f.saveDashboards()),f.init=!0}var f=this;f.init=!1,this.create=function(){return{title:"Default",titleTemplateUrl:"views/custom-dashboard-title.html",structure:"9-3",rows:[{columns:[{styleClass:"col-md-9",widgets:[{type:"holdings"},{type:"dividends"},{type:"chart"},{type:"orders"}]},{styleClass:"col-md-3",widgets:[{type:"simclock",config:{sim_round:!0,timestamp:!0}},{type:"orderform",config:{activeSelection:!0}},{type:"bookoforders"}]}]}]}},a.getDashboards().then(function(a){try{f.dashboards=angular.fromJson(a.data.dashboard),angular.isArray(f.dashboards)&&f.dashboards[0].title||e(),f.init=!0}catch(b){e()}},e),this.getDashboard=function(a){function d(){if(f.init){var b=f.dashboards[a];b?b=f.dashboards[a]:(b=f.create(),f.saveDashboard(a,b)),e.resolve(b)}else c(d,100)}var e=b.defer();return d(),e.promise},this.removeDashboard=function(a){this.dashboards.splice(a,1),this.saveDashboards()},this.saveDashboards=function(){var b=angular.toJson(this.dashboards);localStorage.setItem("dashboard",b),a.saveDashboards(b)},this.saveDashboard=function(a,b){this.dashboards[a]=b,this.saveDashboards()}}]),angular.module("marmixApp").controller("TickerCtrl",["$scope","$http","$interval",function(a,b,c){function d(){b.get("https://m3.marmix.ch/api/v1/tickers/").success(function(b){a.data.tickers=b.results})}a.data={tickers:{}},d();var e=c(d,15e3);a.$on("$destroy",function(){c.cancel(e)})}]),angular.module("marmixApp").controller("ClockCtrl",["$scope","$http","$interval",function(a,b,c){function d(){b.get("https://m3.marmix.ch/api/v1/clock/").success(function(b){a.clock=b})}function e(){b.get("https://m3.marmix.ch/api/v1/market/").success(function(b){a.market=b.results})}e(),d();var f=c(d,2e3),g=c(e,2e3);a.$on("$destroy",function(){c.cancel(f),c.cancel(g)})}]),angular.module("marmixApp").directive("animateOnChange",["$animate",function(a){return{restrict:"A",link:function(b,c,d){b.$watch(d.animateOnChange,function(b,d){if(b!==d){var e=b>d?"change-up":"change";a.addClass(c,e).then(function(){a.removeClass(c,e)})}})}}}]),angular.module("marmixApp").directive("amCharts",function(){return{template:'<div style="height:500px;"></div>',restrict:"E",replace:!0,scope:{chartData:"="},link:function(a,b){a.chartData=a.chartData||[];var c=AmCharts.makeChart(b[0],{type:"stock",theme:"light",pathToImages:"//www.amcharts.com/lib/3/images/",dataSets:[{fieldMappings:[{fromField:"price_open",toField:"open"},{fromField:"price_close",toField:"close"},{fromField:"price_high",toField:"high"},{fromField:"price_low",toField:"low"},{fromField:"volume",toField:"volume"}],color:"#7f8da9",title:"Stock",dataProvider:a.chartData,categoryField:"date"}],panels:[{title:"Value",showCategoryAxis:!1,percentHeight:70,valueAxes:[{id:"v1",dashLength:5}],categoryAxis:{dashLength:5},stockGraphs:[{type:"candlestick",id:"g1",openField:"open",closeField:"close",highField:"high",lowField:"low",valueField:"close",lineColor:"#7f8da9",fillColors:"#7f8da9",negativeLineColor:"#db4c3c",negativeFillColors:"#db4c3c",fillAlphas:1,useDataSetColors:!1,comparable:!1,showBalloon:!0,balloonText:"Open:<b>[[open]]</b><br>Low:<b>[[low]]</b><br>High:<b>[[high]]</b><br>Close:<b>[[close]]</b><br>Sim:<b>R[[sim_round]]/D[[sim_day]]</b><br>",proCandlesticks:!0}],stockLegend:{valueTextRegular:void 0,periodValueTextComparing:"[[percents.value.close]]%"}},{title:"Volume",percentHeight:30,marginTop:1,showCategoryAxis:!0,valueAxes:[{dashLength:5}],categoryAxis:{dashLength:5},stockGraphs:[{valueField:"volume",type:"column",showBalloon:!0,balloonText:"Volume:<b>[[volume]]</b><br>Sim:<b>R[[sim_round]]/D[[sim_day]]</b><br>",fillAlphas:1}],stockLegend:{markerType:"none",markerSize:0,labelText:"",periodValueTextRegular:"[[value.close]]"}}],chartScrollbarSettings:{graph:"g1",graphType:"line",usePeriod:"DD"},chartCursorSettings:{valueLineBalloonEnabled:!0,valueLineEnabled:!0}});a.$watch("chartData",function(){c.initHC&&(c.dataSets[0].dataProvider=a.chartData,c.validateData(),c.zoomOut())},!0)}}}),angular.module("marmixApp").directive("updownClass",function(){return{restrict:"A",link:function(a,b,c){a.$watch(c.updownClass,function(a){a&&(a.toString().indexOf("-")>-1?(b.addClass("down"),b.removeClass("up")):(b.addClass("up"),b.removeClass("down")))})}}}),angular.module("marmixApp").directive("pageSelect",function(){return{restrict:"E",template:'<input type="text" class="select-page" ng-model="inputPage" ng-change="selectPage(inputPage)">',link:function(a){a.$watch("currentPage",function(b){a.inputPage=b})}}}),angular.module("marmixApp").directive("stSelectMultiple",function(){return{restrict:"E",require:"^stTable",scope:{collection:"=",predicate:"@",predicateExpression:"="},templateUrl:"views/stSelectMultiple.html",link:function(a,b,c,d){function e(){a.dropdownLabel=h();var b=g(),c={matchAny:{}};c.matchAny.items=i();var e=c.matchAny.items.length;0===e||e===a.distinctItems.length?c.matchAny.all=!0:c.matchAny.all=!1,d.search(c,b)}function f(){}function g(){var b=a.predicate;return!b&&a.predicateExpression&&(b=a.predicateExpression),b}function h(){var b=a.distinctItems.length,c=i();return b===c.length||0===c.length?"All":1===c.length?c[0]:c.length+" items"}function i(){var b=[];return angular.forEach(a.distinctItems,function(a){a.selected&&b.push(a.value)}),b}function j(b){var c=g(),d=[];angular.forEach(b,function(a){var b=a[c];k(b,d)}),d.sort(function(a,b){return a.value>b.value?1:a.value<b.value?-1:0});var f=i();d.forEach(function(a){a.selected=f.indexOf(a.value)>-1}),a.distinctItems=d,e()}function k(a,b){a&&a.trim().length>0&&!l(b,a)&&b.push({value:a,selected:!0})}function l(a,b){var c=a.find(function(a){return a.value===b});return c}a.dropdownLabel="",a.filterChanged=e,f(),a.$watch("collection",function(){j(a.collection)})}}}),angular.module("marmixApp").directive("stNumberRange",function(){return{restrict:"E",require:"^stTable",scope:{},templateUrl:"views/stNumberRange.html",link:function(a,b,c,d){var e=b.find("input"),f=angular.element(e[0]),g=angular.element(e[1]),h=c.predicate;[f,g].forEach(function(b){b.bind("blur",function(){var b={};a.lower&&(b.lower=a.lower),a.higher&&(b.higher=a.higher),a.$apply(function(){d.search(b,h)})})})}}}),angular.module("marmixApp").filter("startFrom",function(){return function(a,b){return b=+b,a&&a.slice?a.slice(b):a}}),angular.module("marmixApp").filter("numberFixedLen",function(){return function(a,b){var c=parseInt(a,10);if(b=parseInt(b,10),isNaN(c)||isNaN(b))return a;for(c=""+c;c.length<b;)c="0"+c;return c}}),angular.module("marmixApp").filter("customTableFilter",["$filter",function(a){var b=a("filter"),c=function(a,b){return b=(""+b).toLowerCase(),(""+a).toLowerCase().indexOf(b)>-1};return function(a,d){function e(a,b){var d,e,f,g,h=b.before,i=b.after,j=b.lower,k=b.higher;if(angular.isObject(b)){if(b.distinct)return a&&a.toLowerCase()===b.distinct.toLowerCase()?!0:!1;if(b.matchAny){if(b.matchAny.all)return!0;if(!a)return!1;for(var l=0;l<b.matchAny.items.length;l++)if(a.toLowerCase()===b.matchAny.items[l].toLowerCase())return!0;return!1}if(b.before||b.after)try{return h&&(d=b.before,f=new Date(a),g=new Date(d),f>g)?!1:i&&(e=b.after,f=new Date(a),g=new Date(e),g>f)?!1:!0}catch(m){return!1}else if(j||k)return j&&(d=b.lower,a>d)?!1:k&&(e=b.higher,e>a)?!1:!0;return!0}return c(a,b)}var f=b(a,d,e);return f}}]),angular.module("marmixApp").controller("DashboardCtrl",["$scope","$window","$location","$routeParams","dashboardStore",function(a,b,c,d,e){var f=this;e.getDashboard(d.id).then(function(a){f.model=a}),this.currentStock={},this.setCurrentStock=function(a){a?f.currentStock.id=a:delete f.currentStock.id,f.history=[]},this.currentOrder={},this.deleteDashboard=function(){b.confirm("Confirm delete this page?")&&(e.removeDashboard(d.id),c.path("/board/0"))},this.order=function(a,b,c,d){this.currentOrder.stockID=a,this.currentOrder.order_type=b,this.currentOrder.quantity=c,this.currentOrder.price=d},a.$on("adfDashboardChanged",function(a,b,c){e.saveDashboard(d.id,c)})}]),angular.module("marmixApp").controller("NavigationCtrl",["dashboardStore","$location",function(a,b){this.store=a,this.isActive=function(a){return b.path().split("/").pop()===String(a)}}]),angular.module("marmixApp").config(["dashboardProvider",function(a){a.widget("simclock",{title:"Sim Clock",description:"Displays the current simulation round and day",templateUrl:"views/widget_simclock.html",config:{sim_round:!0,timestamp:!0},edit:{templateUrl:"views/widget_edit_simclock.html"},controller:["$scope","marmixData",function(a,b){a.data=b}]})}]),angular.module("marmixApp").config(["dashboardProvider",function(a){a.widget("orders",{title:"Orders",description:"Displays orders",templateUrl:"views/widget_orders.html",edit:{template:" "},controller:["$scope","marmixData",function(a,b){a.data=b}]})}]),angular.module("marmixApp").config(["dashboardProvider",function(a){a.widget("chart",{title:"Chart",description:"Displays chart for a stock",templateUrl:"views/widget_chart.html",controller:["$scope","marmixData","config",function(a,b,c){function d(c){b.stocksDetails[c]={history:[]},b.updateStock(c);var d=b.getStock(c);d&&(a.$parent.model.title=a.$parent.content.title+": "+d.symbol)}a.data=b,a.dashboard=b.findDashboard(a),c.symbol?b.getStockPromiseFromSymbol(c.symbol).then(function(b){a.stockID=b.id,d(a.stockID)}):a.$watch("dashboard.currentStock.id",function(){a.dashboard.currentStock.id&&d(a.dashboard.currentStock.id)})}],edit:{templateUrl:"views/widget_edit_stock_select.html",controller:["$scope","marmixData",function(a,b){a.data=b}]}})}]),angular.module("marmixApp").config(["dashboardProvider",function(a){a.widget("bookoforders",{title:"Book of Orders",description:"Displays the current market orders",templateUrl:"views/widget_bookoforders.html",controller:["$scope","marmixData","config",function(a,b,c){function d(a){for(var b=0;b<a.length;b++)if("MARKET"===a[b].order_type)return b}function e(c){b.booksoforders[c]=[],b.updateStockBook(c);var d=b.getStock(c);d&&(a.$parent.model.title=a.$parent.content.title+": "+d.symbol)}a.data=b,a.dashboard=b.findDashboard(a),a.limitList=function(a){if(c.threshold&&a){var b=d(a),e=Math.max(0,b-c.threshold),f=Math.min(a.length,b+c.threshold);return a.slice(e,f)}return a},c.symbol?b.getStockPromiseFromSymbol(c.symbol).then(function(b){a.stockID=b.id,e(a.stockID)}):a.$watch("dashboard.currentStock.id",function(){a.dashboard.currentStock.id&&e(a.dashboard.currentStock.id)})}],edit:{templateUrl:"views/widget_edit_bookoforders.html",controller:["$scope","marmixData",function(a,b){a.data=b}]}})}]),angular.module("marmixApp").config(["dashboardProvider",function(a){a.widget("dividends",{title:"Dividends",description:"Displays dividends",templateUrl:"views/widget_dividends.html",controller:["$scope","marmixData","config",function(a,b,c){a.data=b,a.stockFilter=function(a){return c.stock&&Object.keys(c.stock).every(function(a){return c.stock[a]})?c.stock.hasOwnProperty(a.stock)?c.stock:!1:!0}}],edit:{templateUrl:"views/widget_holdings_edit.html",controller:["$scope","marmixData",function(a,b){a.data=b}]}})}]),angular.module("marmixApp").config(["dashboardProvider",function(a){a.widget("holdings",{title:"Holdings",description:"Displays current holdings",templateUrl:"views/widget_holdings.html",controller:["$scope","marmixData","config",function(a,b,c){a.data=b,a.stockFilter=function(a){return c.stock&&Object.keys(c.stock).every(function(a){return c.stock[a]})?c.stock.hasOwnProperty(a.symbol)?c.stock:!1:!0},a.dashboard=b.findDashboard(a)}],edit:{templateUrl:"views/widget_holdings_edit.html",controller:["$scope","marmixData",function(a,b){a.data=b}]}})}]),angular.module("marmixApp").config(["dashboardProvider",function(a){a.widget("orderform",{title:"Order Form",description:"Displays an order form to buy/sell",templateUrl:"views/widget_orderform.html",config:{activeSelection:!0},edit:{templateUrl:"views/widget_edit_orderform.html"},controller:["$scope","marmixData","config","$timeout",function(a,b,c,d){a.data=b,a.dashboard=b.findDashboard(a),a.alerts=[],a.closeAlert=function(b){a.alerts.splice(b,1)},a.ok=function(c){var d=angular.copy(a.order);d.stock=d.stock.id,d.order_type=c,b.sendOrder(d),a.alerts.push({type:"warning",msg:"Submitted order: "+d.order_type+" "+d.quantity+" "+d.stock.symbol})},a.reset=function(){a.order={stock:{id:void 0},order_type:void 0,price:null,quantity:void 0}},a.reset(),c.activeSelection&&a.$watch("dashboard.currentOrder",function(){a.dashboard.currentOrder&&(a.order.order_type=a.dashboard.currentOrder.order_type,a.order.stock.id=String(a.dashboard.currentOrder.stockID),a.order.quantity=a.dashboard.currentOrder.quantity,a.order.price=a.dashboard.currentOrder.price,a.updated=!0,d(function(){a.updated=!1},2e3))},!0)}]})}]),angular.module("marmixApp").config(["dashboardProvider",function(a){a.structure("8-4",{rows:[{columns:[{styleClass:"col-md-8",widgets:[]},{styleClass:"col-md-4",widgets:[]}]}]}).structure("9-3",{rows:[{columns:[{styleClass:"col-md-9",widgets:[]},{styleClass:"col-md-3",widgets:[]}]}]})}]),angular.module("marmixApp").run(["$templateCache",function(a){a.put("views/clock.html",'<div id="beamer_clock" animate-on-change="clock.timestamp"> R{{clock.sim_round}}/D{{clock.sim_day |numberFixedLen:2 }} - {{clock.state}} </div> <div class="col-md-6 col-md-offset-3"> <h2>Stocks</h2> <table class="table table-striped"> <thead> <tr> <th>Symbol</th> <th class="text-right">Quantity</th> <th class="text-right">Current</th> </tr> </thead> <tbody> <tr ng-repeat="stock in market track by stock.id"> <td>{{stock.symbol}}</td> <td class="text-right">{{stock.quantity | number: 0}}</td> <td class="text-right stock" animate-on-change="stock.price"> <span class="glyphicon glyphicon-arrow-up"></span> <span class="glyphicon glyphicon-arrow-down"></span> {{stock.price | number : 2}}</td> </tr> </tbody> </table> </div>'),a.put("views/custom-dashboard-title.html",'<div ng-if="editMode" class="alert alert-info">Currently in edit mode. Save or undo your changes when you are done.</div> <div class="dashboard-edit"> <button class="btn btn-sm btn-default" ng-if="options.editable && !editMode" ng-click="toggleEditMode()">Edit</button> <button class="btn btn-sm btn-primary" ng-if="editMode" ng-click="addWidgetDialog()">Add widget</button> <button class="btn btn-sm btn-default" ng-if="editMode" ng-click="editDashboardDialog()">Dashboard settings</button> <button class="btn btn-sm btn-success" ng-if="options.editable && editMode" ng-click="toggleEditMode()">Save changes</button> <button class="btn btn-sm btn-warning" ng-if="editMode" ng-click="cancelEditMode()">Undo changes</button> <button class="btn btn-sm btn-danger" ng-if="editMode" ng-click="$parent.$parent.$parent.dashboard.deleteDashboard()">Delete</button> </div>'),a.put("views/dashboard.html",'<div ng-if="!dashboard.model"> <div class="alert alert-info">Loading dashboard</div> <div class="progress progress-striped active"> <div class="progress-bar" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%"></div> </div> </div> <div ng-if="dashboard.model"> <adf-dashboard name="{{dashboard.name}}" structure="4-8" adf-model="dashboard.model" enableconfirmdelete="true" collapsible="true" maximizable="true"> </div>'),a.put("views/pagination.custom.html",'<nav ng-if="pages.length >= 2"> <ul class="pagination"> <li><a ng-click="selectPage(1)">First</a> </li><li><a ng-click="selectPage(currentPage - 1)">&lt;</a> </li><li><a><page-select></page-select> of {{numPages}}</a> </li><li><a ng-click="selectPage(currentPage + 1)">&gt;</a> </li><li><a ng-click="selectPage(numPages)">Last</a></li> </ul> </nav>'),a.put("views/stNumberRange.html",'<form class="form-inline st-number-range"> <div class="form-group"> <label class="sr-only">lower</label> <input class="form-control input-sm" type="number" step="0.01" ng-model="lower" placeholder="lower"> </div> <div class="form-group"> <label class="sr-only">higher</label> <input type="number" class="form-control input-sm" step="0.01" ng-model="higher" placeholder="higher"> </div> </form>'),a.put("views/stSelectMultiple.html",'<div class="dropdown"> <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true"> {{dropdownLabel}} <span class="caret"></span> </button> <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"> <li ng-repeat="item in distinctItems"> <label> <input type="checkbox" ng-model="item.selected" ng-click="filterChanged()">{{item.value}}</label> </li> </ul> </div>'),a.put("views/ticker.html",'<div class="container-fluid"> <div class="row"> <div class="col-md-12"> <h2>Net income summary</h2> <table class="table table-striped table-hover"> <thead> <tr> <th>Round</th> <th ng-repeat="ticker in data.tickers track by ticker.id" class="text-right">{{ticker.symbol}}</th> </tr> </thead> <tbody> <tr ng-repeat-start="share in data.tickers[0].shares track by share.id"> <td>R{{share.sim_round}}</td> <td ng-repeat="ticker in data.tickers track by ticker.id" class="text-right"> {{data.tickers[$index].shares[$parent.$index].net_income | number: 2}} </td> </tr> <tr> <td>Dividends</td> <td ng-repeat="ticker in data.tickers track by ticker.id" class="text-right"> {{data.tickers[$index].shares[$parent.$index].dividends | number: 2}} </td> </tr> <tr ng-repeat-end> <td>Drift</td> <td ng-repeat="ticker in data.tickers track by ticker.id" class="text-right"> {{data.tickers[$index].shares[$parent.$index].drift}} </td> </tr> </tbody> </table> </div> </div> <div class="row"> <div class="col-md-12"> <h2>Daily net income</h2> <table class="table table-striped table-hover"> <thead> <tr> <th>Round/Day</th> <th ng-repeat="ticker in data.tickers track by ticker.id" class="text-right">{{ticker.symbol}}</th> </tr> </thead> <tbody> <tr ng-repeat="fin in data.tickers[0].financials track by fin.id"> <td>R{{fin.sim_round}}/D{{fin.sim_day|numberFixedLen:2}}</td> <td ng-repeat="ticker in data.tickers track by ticker.id" class="text-right"> {{data.tickers[$index].financials[$parent.$index].daily_net_income | number: 2}} </td> </tr> </tbody> </table> </div> </div> </div>'),a.put("views/widget_bookoforders.html",'<table class="table"> <thead> <tr> <th class="text-right">Quantity</th> <th class="text-right">Nb of orders</th> <th class="text-right">Price</th> <th class="text-right">Action</th> </tr> </thead> <tbody> <tr ng-repeat="order in limitList(data.booksoforders[stockID || dashboard.currentStock.id]) track by $index" ng-class="{bid: order.order_type == \'BID\', ask: order.order_type == \'ASK\', market: order.order_type == \'MARKET\'}"> <td class="text-right">{{order.quantity | number: 0}}</td> <td class="text-right">{{ order.orders | number: 0 }}</td> <td class="text-right">{{order.price | number : 2}}</td> <td class="text-right"> <button class="btn btn-sm btn-primary" ng-click="dashboard.order(stockID || dashboard.currentStock.id, order.order_type === \'MARKET\' ? undefined : order.order_type === \'BID\' ? \'ASK\' : \'BID\', order.quantity, order.price)">SELECT</button> </td> </tr> </tbody> </table>'),a.put("views/widget_chart.html",'<div ng-show="data.stocksDetails[stockID || dashboard.currentStock.id].history.length == 0">Data loading</div> <am-charts ng-show="data.stocksDetails[stockID || dashboard.currentStock.id].history.length > 0" chart-data="data.stocksDetails[stockID || dashboard.currentStock.id].history"></am-charts>'),a.put("views/widget_dividends.html",'<uib-tabset> <uib-tab ng-repeat="(r, rd) in data.dividends" heading="R{{r}}"> <table class="table table-striped"> <thead> <tr> <th>Symbol</th> <th class="text-right">Amount</th> </tr> </thead> <tbody> <tr ng-repeat="dividend in rd|filter:stockFilter track by dividend.id"> <td>{{dividend.stock}}</td> <td class="text-right">{{dividend.amount | number : 2}}</td> </tr> </tbody> </table> </uib-tab> </uib-tabset>'),a.put("views/widget_edit_bookoforders.html",'<div class="form-group"> <label for="stock">Stock</label> <select id="stock" class="form-control" ng-model="config.symbol"> <option value="">Active selection</option> <option ng-repeat="m in data.market" value="{{m.symbol}}">{{m.symbol}} {{m.name}}</option> </select> </div> <div class="form-group"> <label for="threshold">Threshold</label> <input id="threshold" type="number" class="form-control" ng-model="config.threshold" placeholder="+/- rows around market"> </div>'),a.put("views/widget_edit_orderform.html",'<div class="checkbox"> <label> <input type="checkbox" ng-model="config.activeSelection"> Update to active selection </label> </div>'),a.put("views/widget_edit_simclock.html",'<div class="checkbox"> <label> <input type="checkbox" ng-model="config.sim_round"> Show sim round </label> </div> <div class="checkbox"> <label> <input type="checkbox" ng-model="config.timestamp"> Show sim timestamp </label> </div>'),a.put("views/widget_edit_stock_select.html",'<div class="form-group"> <label for="stock">Stock</label> <select id="stock" class="form-control" ng-model="config.symbol"> <option value="">Active selection</option> <option ng-repeat="m in data.market" value="{{m.symbol}}">{{m.symbol}} {{m.name}}</option> </select> </div>'),a.put("views/widget_holdings.html",'<table class="table table-striped"> <thead> <tr> <th>Stock</th> <th class="text-right">Quantity</th> <th class="text-right">Total Quantity</th> <th class="text-right">% Owned</th> <th class="text-right">Quote</th> <th class="text-right">Market Value</th> <th class="text-right">Purchase Value</th> <th class="text-right">Gain</th> <th class="text-right">Gain %</th> <th class="text-right">Action</th> </tr> </thead> <tbody> <tr ng-click="dashboard.setCurrentStock(holding.stock_id)" ng-class="{selected: dashboard.currentStock.id == holding.stock_id}" ng-repeat="holding in data.holdings.stocks|filter:stockFilter track by holding.stock_id"> <td class="pointer">{{holding.symbol}}</td> <td class="text-right">{{holding.quantity}}</td> <td class="text-right">{{holding.outstanding_shares | number : 0}}</td> <td class="text-right">{{holding.shares_p*100 | number : 2}}%</td> <td class="text-right">{{holding.price | number : 2}}</td> <td class="text-right">{{holding.value | number : 2}}</td> <td class="text-right">{{holding.amount | number : 2}}</td> <td class="text-right" updown-class="holding.gain">{{holding.gain | number : 2}}</td> <td class="text-right" updown-class="holding.gain_p">{{holding.gain_p | number : 2}}%</td> <td class="text-right"> <!--\r\n        <button class="btn btn-success btn-sm" ng-click="order(holding.stock_id, \'BID\');$event.stopPropagation()">Buy</button>\r\n        <button class="btn btn-danger btn-sm" ng-click="order(holding.stock_id, \'ASK\');$event.stopPropagation()">Sell</button>\r\n        --> <button class="btn btn-primary btn-sm" ng-click="dashboard.order(holding.stock_id, undefined, holding.quantity)">SELECT</button> </td> </tr> <tr ng-show="data.holdings.cash.TRANSACTIONS" ng-click="dashboard.setCurrentStock()" class="italic"> <td class="pointer" colspan="3">{{data.holdings.cash.TRANSACTIONS.asset}}</td> <td></td> <td></td> <td class="text-right">{{data.holdings.cash.TRANSACTIONS.amount | number : 2}}</td> <td class="text-right">{{data.holdings.cash.TRANSACTIONS.value | number : 2}}</td> <td></td> <td></td> <td></td> </tr> <tr ng-show="data.holdings.cash.DIVIDENDS" ng-click="dashboard.setCurrentStock()" class="italic"> <td class="pointer" colspan="3">{{data.holdings.cash.DIVIDENDS.asset}}</td> <td></td> <td></td> <td class="text-right">{{data.holdings.cash.DIVIDENDS.amount | number : 2}}</td> <td class="text-right">{{data.holdings.cash.DIVIDENDS.value | number : 2}}</td> <td></td> <td></td> <td></td> </tr> <tr> <td class="pointer" colspan="3" ng-click="dashboard.setCurrentStock()">{{data.holdings.cash.CASH.asset}}</td> <td></td> <td></td> <td class="text-right">{{data.holdings.cash.CASH.amount | number : 2}}</td> <td class="text-right">{{data.holdings.cash.CASH.value | number : 2}}</td> <td></td> <td></td> <td></td> </tr> <tr> <td colspan="3">Balance</td> <td></td> <td></td> <td class="text-right">{{data.holdings.balance.market_value | number : 2}}</td> <td class="text-right">{{data.holdings.balance.purchase_value | number : 2}}</td> <td class="text-right" updown-class="data.holdings.balance.gain">{{data.holdings.balance.gain | number : 2}}</td> <td class="text-right" updown-class="data.holdings.balance.gain_p">{{data.holdings.balance.gain_p | number : 2}}%</td> <td></td> </tr> </tbody> </table>'),a.put("views/widget_holdings_edit.html",'<div class="checkbox" ng-repeat="m in data.market"> <label> <input type="checkbox" value="m.symbol" ng-model="config.stock[m.symbol]"> {{m.symbol}} {{m.name}} </label> </div>'),a.put("views/widget_orderform.html",'<div class="modal-body" ng-class="{\'updated\': updated}"> <uib-alert ng-repeat="alert in alerts" type="{{alert.type}}" close="closeAlert($index)" dismiss-on-timeout="2000">{{alert.msg}}</uib-alert> <form> <div class="form-group"> <label class="control-label">Stock</label> <select required class="form-control" ng-model="order.stock.id"> <option ng-repeat="m in data.market" value="{{m.id}}">{{m.symbol}} {{m.name}}</option> </select> </div> <div class="form-group"> <label for="id_quantity" class="control-label">Quantity</label> <input required type="number" class="numberinput form-control" id="id_quantity" min="1" ng-model="order.quantity"> <p id="hint_id_quantity" class="help-block">Quantity ordered. If the total quantity can not be provided, a new order will be created with the balance</p> </div> <div class="form-group"> <label for="id_price" class="control-label">Price tag</label> <input type="number" class="numberinput form-control" id="id_price" ng-model="order.price" placeholder="current market: {{data.getStock(order.stock.id).price|number:2}}"> <p id="hint_id_price" class="help-block">Price tag for one stock. If NULL, best available price</p> </div> </form> <div class="text-right">Cost: {{order.quantity * (order.price || data.getStock(order.stock.id).price) || 0 | number: 2}}</div> <div class="text-right">CASH: {{data.holdings.cash.CASH.amount | number: 2}}</div> <div class="text-right">Diff: {{data.holdings.cash.CASH.amount - (order.quantity * (order.price || data.getStock(order.stock.id).price)) | number: 2}}</div> </div> <div class="modal-footer"> <button class="btn btn-warning" ng-click="reset()">RESET</button> <button ng-disabled="order.order_type==\'ASK\' ||!order.quantity || !order.stock.id" class="btn btn-success" ng-click="ok(\'BID\')">BUY</button> <button ng-disabled="order.order_type==\'BID\' || !order.quantity || !order.stock.id" class="btn btn-danger" ng-click="ok(\'ASK\')">SELL</button> </div>'),a.put("views/widget_orders.html",'<table st-set-filter="customTableFilter" st-table="data.displayOrders" st-safe-src="data.orders" class="table table-striped orders"> <thead> <tr> <th>Round/Day</th> <th>Date/Time</th> <th>Symbol</th> <th>Type</th> <th class="text-right">Quantity</th> <th class="text-right">Price</th> <th class="text-right">Completed</th> </tr> <tr> <th> <input st-search="date" placeholder="Filter round/day" class="input-sm form-control" type="search"> </th> <th></th> <th> <st-select-multiple collection="data.orders" predicate="symbol"></st-select-multiple> </th> <th> <st-select-multiple collection="data.orders" predicate="order_type"></st-select-multiple> </th> <th class="text-right"> <st-number-range predicate="quantity"></st-number-range> </th> <th class="text-right"> <st-number-range predicate="price"></st-number-range> </th> <th class="text-right"> <st-select-multiple collection="data.orders" predicate="state"></st-select-multiple> </th> </tr> </thead> <tbody> <tr class="order" ng-class="order.state" ng-repeat="order in data.displayOrders track by order.id"> <!-- TODO: validated? cancel--> <td>{{order.date}}</td> <td>{{order.created_at | date:\'medium\'}}</td> <td>{{order.symbol}}</td> <td>{{order.order_type}}</td> <td class="text-right">{{order.quantity}}</td> <td class="text-right">{{(order.price | number : 2) || \'market\'}}</td> <td class="text-right"> <span ng-show="order.state == \'PROCESSED\'">{{order.transaction | date:\'medium\'}}</span> <span ng-show="order.state == \'FAILED\'">FAILED</span> <button class="btn btn-warning btn-sm" ng-click="data.cancelOrder(order)" ng-show="order.state == \'SUBMITTED\'">Cancel</button> </td><td> </td></tr> </tbody> <tfoot> <tr> <td colspan="7" class="text-center"> <div st-pagination="" st-items-by-page="10" st-template="views/pagination.custom.html"></div> </td> </tr> </tfoot> </table>'),
a.put("views/widget_simclock.html",'<div class="simclock"> <h2 ng-show="config.sim_round">R{{data.clock.sim_round}}/D{{data.clock.sim_day |numberFixedLen:2 }} - {{data.clock.state}}</h2> <small ng-show="config.timestamp">{{data.clock.timestamp|date:"medium"}}</small> </div>')}]);