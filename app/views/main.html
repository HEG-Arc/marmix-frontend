<div class="container-fluid">
<div class="row">
  <div class="col-md-6">
    <h2>Holdings</h2>
    <h3>Clock: R{{data.holdings.clock.sim_round}}/D{{data.holdings.clock.sim_day}} - {{data.holdings.clock.state}} ({{data.holdings.clock.timestamp|date:'medium'}})</h3>  

    <table class="table table-striped">
      <thead>
        <tr>
          <th>Stock</th>
          <th class="text-right">Quantity</th>
          <th class="text-right">Quote</th>
          <th class="text-right">Market Value</th>
          <th class="text-right">Purchase Value</th>
          <th class="text-right">Gain</th>
          <th class="text-right">Gain %</th>
          <th class="text-right">Action</th>
        </tr>
      </thead>
      <tbody>
        <tr ng-class="{selected: currentStock.id == holding.stock_id}" ng-repeat="holding in data.holdings.stocks track by holding.stock_id">
          <td ng-click="$parent.currentStock=data.getStock(holding.stock_id)">{{holding.symbol}}</td>
          <td class="text-right">{{holding.quantity}}</td>
          <td class="text-right">{{holding.price | number : 2}}</td>
          <td class="text-right">{{holding.value | number : 2}}</td>
          <td class="text-right">{{holding.amount | number : 2}}</td>
          <td class="text-right" updown-class="holding.gain">{{holding.gain | number : 2}}</td>
          <td class="text-right" updown-class="holding.gain_p">{{holding.gain_p | number : 2}}%</td>
          <td class="text-right">
            <button class="btn btn-success btn-sm" ng-click="order(holding.stock_id, 'BID')">Buy</button>
            <button class="btn btn-danger btn-sm" ng-click="order(holding.stock_id, 'ASK')">Sell</button>
          </td>
        </tr>
        <tr ng-repeat="cash in data.holdings.cash">
          <td colspan="3" ng-click="$parent.currentStock={history:[]}">{{cash.asset}}</td>
          <td class="text-right">{{cash.amount | number : 2}}</td>
          <td class="text-right">{{cash.value | number : 2}}</td>
          <td></td>
          <td></td>
          <td></td>
        </tr>
        <tr>
          <td colspan="3">Balance</td>
          <td class="text-right">{{data.holdings.balance.market_value | number : 2}}</td>
          <td class="text-right">{{data.holdings.balance.purchase_value | number : 2}}</td>
          <td class="text-right" updown-class="data.holdings.balance.gain">{{data.holdings.balance.gain | number : 2}}</td>
          <td class="text-right" updown-class="data.holdings.balance.gain_p">{{data.holdings.balance.gain_p | number : 2}}%</td>
          <td></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<div class="row" ng-show="currentStock.history.length > 0">
  <div class="col-md-12">
    <h3>{{currentStock.symbol}}, {{currentStock.name}}</h3>
    <am-charts chart-data="currentStock.history"></am-charts>
  </div>
</div>

<div class="row">
  <div class="col-md-4">
    <h2>Dividends payment</h2>
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Symbol</th>
          <th>Amount</th>
        </tr>
      </thead>
      <tbody>
      <tr ng-repeat="dividend in data.dividends track by dividend.id">
        <td>{{dividend.stock.symbol}}</td>
        <td>{{dividend.amount | number : 2}}</td>
      </tr>
      </tbody>
    </table>
  </div>
</div>

<div class="row">
  <div class="col-md-4">
    <h2>Stocks</h2>
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Symbol</th>
          <th class="text-right">Current</th>
          <th class="text-right">Action</th>
        </tr>
      </thead>
      <tbody>
      <tr  ng-class="{selected: currentStock.id == stock.id}" ng-repeat="stock in data.stocks track by stock.id">
        <td ng-click="$parent.currentStock=stock">{{stock.symbol}}</td>
        <td class="text-right stock" animate-on-change="stock.price">
        <span class="glyphicon glyphicon-arrow-up"></span>
        <span class="glyphicon glyphicon-arrow-down"></span>
        {{stock.price | number : 2}}</td>
        <td class="text-right">
          <button class="btn btn-success btn-sm" ng-click="order(stock.id, 'BID')">Buy</button>
          <button class="btn btn-danger btn-sm" ng-click="order(stock.id, 'ASK')">Sell</button>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</div>

<div class="row">
  <div class="col-md-4">
    <h2>Orders</h2>
    <table class="table table-striped">
      <thead>
      <tr>
        <th>Date/Time</th>
        <th>Symbol</th>
        <th>Type</th>
        <th class="text-right">Quantity</th>
        <th class="text-right">Price</th>
        <th class="text-right">Completed</th>
      </tr>
      </thead>
      <tbody>
      <tr ng-repeat="order in data.orders | startFrom:(orderCurrentPage-1)*orderItemsPerPage | limitTo:orderItemsPerPage track by order.id">
      <!-- TODO: validated? cancel-->
        <td>{{order.created_at | date:'medium'}}</td>
        <td>{{order.stock.symbol}}</td>
        <td>{{order.order_type}}</td>
        <td class="text-right">{{order.quantity}}</td>
        <td class="text-right">{{(order.price | number : 2) || 'market'}}</td>
        <td class="text-right">
          {{order.transaction | date:'medium'}}
          <button class="btn btn-warning btn-sm" ng-click="data.cancelOrder(order)" ng-show="order.transaction == null">Cancel</button>
        <td>
      </tr>
      </tbody>
    </table>
    <pagination items-per-page="orderItemsPerPage" total-items="data.orders.length" ng-model="orderCurrentPage"></pagination>
  </div>
</div>

  </div>
<script type="text/ng-template" id="orderModalContent.html">
    <div class="modal-header">
        <h3 class="modal-title">Send a {{order.order_type}} Order</h3>
    </div>
    <div class="modal-body">
      <form>
        <div class="form-group">
          <label class="control-label">Stock</label>
          <div>{{stock.symbol}}, {{stock.name}}</div>
        </div>
        <div class="form-group">
          <label for="id_quantity" class="control-label">Quantity</label>
          <input type="number" class="numberinput form-control" id="id_quantity" min="1" ng-model="order.quantity"/>
          <p id="hint_id_quantity" class="help-block">Quantity ordered. If the total quantity can not be provided, a new order will be created with the balance</p>
        </div>
        <div class="form-group">
          <label for="id_price" class="control-label">Price tag</label>
          <input type="number" class="numberinput form-control"  id="id_price" ng-model="order.price" placeholder="current market: {{stock.price|number:2}}" />
          <p id="hint_id_price" class="help-block">Price tag for one stock. If NULL, best available price</p>
        </div>
      </form>
      <div class="text-right">Cost: {{order.quantity * (order.price || stock.price)| number: 2}}</div>
      <div class="text-right">CASH: {{data.holdings.cash[2].amount | number: 2}}</div>
      <div class="text-right">Diff: {{data.holdings.cash[2].amount - (order.quantity * (order.price || stock.price)) | number: 2}}</div>
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary" ng-click="ok()">Send</button>
        <button class="btn btn-warning" ng-click="cancel()">Cancel</button>
    </div>
</script>
